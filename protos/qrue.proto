syntax = "proto3";

// optional = nullable
// may change in future!

import "il2cpp.proto";
import "unity.proto";

// COMMAND/QUERY PACKETS

message SetField {
    uint64 fieldId = 1;
    uint64 objectAddress = 2;
    ProtoDataPayload value = 3;
}

message SetFieldResult {
    uint64 fieldId = 1;
}

message GetField {
    uint64 fieldId = 1;
    uint64 objectAddress = 2;
}

message GetFieldResult {
    uint64 fieldId = 1;
    ProtoDataPayload value = 2;
}

message InvokeMethod {
    uint64 methodId = 1;
    uint64 objectAddress = 2;
    repeated ProtoTypeInfo generics = 3;
    repeated ProtoDataPayload args = 4;
}

message InvokeMethodResult {
    enum Status {
        ERR = 0;
        OK = 1;
    }
    Status status = 1;
    uint64 methodId = 2;
    ProtoDataPayload result = 3;
    // map from parameter index
    map<int32, ProtoDataPayload> byrefChanges = 4;
    optional string error = 5; /* nullable */
}

message SearchObjects {
    ProtoClassInfo componentClass = 1;
    optional string name = 2; /* nullable */
}

message SearchObjectsResult {
    repeated ProtoObject objects = 1;
}

message GetAllGameObjects {
}

message GetAllGameObjectsResult {
    // TODO: GameObject data such as hierarchy
    repeated ProtoGameObject objects = 1;
}

message GetGameObjectComponents {
    /// GameObject address
    uint64 address = 1;
}

message GetGameObjectComponentsResult {
    repeated ProtoComponent components = 1;
}

message ReadMemory {
    uint64 address = 1;
    uint64 size = 2;
}

message ReadMemoryResult {
    enum Status {
        ERR = 0;
        OK = 1;
    }
    Status status = 1;
    uint64 address = 2;
    bytes data = 3;
}

message WriteMemory {
    uint64 address = 1;
    bytes data = 2;
}

message WriteMemoryResult {
    enum Status {
        ERR = 0;
        OK = 1;
    }
    Status status = 1;
    uint64 address = 2;
    uint64 size = 3;
}

message GetClassDetails {
    ProtoClassInfo classInfo = 1;
}

message GetClassDetailsResult {
    ProtoClassDetails classDetails = 1;
}

message GetInstanceClass {
    uint64 address = 1;
}

message GetInstanceClassResult {
    ProtoClassInfo classInfo = 1;
}

message GetInstanceDetails {
    uint64 address = 1;
}

message GetInstanceDetailsResult {
    ProtoClassDetails classDetails = 1;

    /* nullable */
    map<uint64, bytes> fieldValues = 3;
    /* nullable */
    map<uint64, bytes> propertyValues = 4;
}

// TODO: Rename?
message PacketWrapper {
    uint64 queryResultId = 1;
    oneof Packet {
        SetField setField = 2;
        SetFieldResult setFieldResult = 3;
        GetField getField = 4;
        GetFieldResult getFieldResult = 5;
        InvokeMethod invokeMethod = 6;
        InvokeMethodResult invokeMethodResult = 7;
        SearchObjects searchObjects = 8;
        SearchObjectsResult searchObjectsResult = 9;
        GetAllGameObjects getAllGameObjects = 10;
        GetAllGameObjectsResult getAllGameObjectsResult = 11;
        GetGameObjectComponents getGameObjectComponents = 12;
        GetGameObjectComponentsResult getGameObjectComponentsResult = 13;
        ReadMemory readMemory = 14;
        ReadMemoryResult readMemoryResult = 15;
        WriteMemory writeMemory = 16;
        WriteMemoryResult writeMemoryResult = 17;
        GetClassDetails getClassDetails = 18;
        GetClassDetailsResult getClassDetailsResult = 19;
        GetInstanceClass getInstanceClass = 20;
        GetInstanceClassResult getInstanceClassResult = 21;
        GetInstanceDetails getInstanceDetails = 22;
        GetInstanceDetailsResult getInstanceDetailsResult = 23;
    }
}
