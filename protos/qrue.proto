syntax = "proto3";

// optional = nullable
// may change in future!

// Type Identification
message ClassSimpleData {
    string namespaze = 1;
    string clazz = 2;
    repeated ClassSimpleData generics = 3;
}

message StructData {
    ClassSimpleData clazz = 1;

    map<int32, TypeInfoMsg> contents = 2;

}

message TypeInfo {
    enum Primitive {
        BOOLEAN = 0;
        CHAR = 1;
        INT = 2;
        LONG = 3;
        FLOAT = 4;
        DOUBLE = 5;
        STRING = 6;
        LIST = 7;
        ARRAY = 8;
    }
    oneof Info {
        Primitive primitiveInfo = 1;
        StructData structInfo = 2;
        ClassSimpleData classInfo = 3;
    }
}

// Type Details
message FieldInfo {
    string name = 1;
    uint64 id = 2;
    TypeInfo type = 3;
}

message PropertyInfo {
    string name = 1;
    bool hasGet = 2;
    uint64 getId = 3;
    bool hasSet = 4;
    uint64 setId = 5;
    TypeInfo type = 6;
}

message MethodInfo {
    string name = 1;
    uint64 id = 2;

    map<string, TypeInfoMsg> args = 3;
    TypeInfo returnType = 4;
}

/// Contains the class data in its entirety
// NOT APPLICABLE TO STRUCTS OR PRIMITIVES
message ClassDetails {
    ClassSimpleData clazz = 1;

    repeated FieldInfo fields = 2;
    repeated PropertyInfo properties = 3;
    repeated MethodInfo methods = 4;
    
    repeated ClassSimpleData interfaces = 5; /* nullable */

    ClassDetails parent = 6; /* nullable */
}

// Data Sending
message DataPayload {
    TypeInfo typeInfo = 1; /* nullable */

    bytes data = 2;
}

message ProtoVector2 {
    float x = 1;
    float y = 2;
}

message ProtoVector3 {
    float x = 1;
    float y = 2;
    float z = 3;
}

message ProtoVector4 {
    float x = 1;
    float y = 2;
    float z = 3;
    float w = 4;
}

//Unity Stuff
message ProtoObject {
    uint64 address = 1;
    string name = 2;

    ClassSimpleData classInfo = 3;
}

message ProtoComponent {
    uint64 address = 1;
    string name = 2;

    uint64 gameObject = 3;
    // TODO: TRANSFORM
    ClassSimpleData classInfo = 4;
}

message ProtoTransform {
    uint64 address = 1;
    string name = 2;

    int32 childCount = 3;
    uint64 parent = 4;
}

message ProtoGameObject {
    uint64 address = 1;
    string name = 2;

    bool active = 3;
    int32 layer = 4;
    ProtoScene scene = 5;
    string tag = 6;     /* optional */
    ProtoTransform transform = 7;
}

message ProtoScene {
    int32 handle = 1;
    string name = 2;
    bool isLoaded = 3;
}

// COMMAND/QUERY PACKETS

message InvokeMethod {
    uint64 methodId = 1;
    repeated DataPayload args = 2;
}

message InvokeMethodResult {
    enum Status {
        ERR = 0;
        OK = 1;
        NOT_FOUND = 2;
    }
    Status status = 1;
    uint64 methodId = 2;
    uint64 invokeUUID = 3;
    DataPayload result = 4;
    string error = 5; /* nullable */
}

message SearchObjects {
    ClassSimpleData componentClass = 1;
    string name = 2; /* nullable */
}

message SearchObjectsResult {
    repeated ProtoObject objects = 1;
}

message GetAllGameObjects {

}

message GetAllGameObjectsResult {
    // TODO: GameObject data such as hierarchy
    repeated ProtoGameObject objects = 1;
}

message GetGameObjectComponents {
    uint64 address = 1;
}
message GetGameObjectComponentsResult {
    repeated ProtoComponent components = 1;
}

message ReadMemory {
    uint64 address = 1;
    uint64 size = 2;
}

message ReadMemoryResult {
    enum Status {
        ERR = 0;
        OK = 1;
    }
    Status status = 1;
    uint64 address = 2;
    bytes data = 3;
}

message WriteMemory {
    uint64 address = 1;
    bytes data = 2;
}

message WriteMemoryResult {
    enum Status {
        ERR = 0;
        OK = 1;
    }
    Status status = 1;
    uint64 address = 2;
    uint64 size = 3;
}

// TODO: Rename?
message PacketWrapper {
    uint64 queryResultId = 1;
    oneof Packet {
        InvokeMethod invokeMethod = 2;
        InvokeMethodResult invokeMethodResult = 3;
        SearchObjects searchObjects = 4;
        SearchObjectsResult searchObjectsResult = 5;
        GetAllGameObjects getAllGameObjects = 6;
        GetAllGameObjectsResult getAllGameObjectsResult = 7;
        GetGameObjectComponents getGameObjectComponents = 8;
        GetGameObjectComponentsResult getGameObjectComponentsResult = 9;
        ReadMemory readMemory = 10;
        ReadMemoryResult readMemoryResult = 11;
        WriteMemory writeMemory = 12;
        WriteMemoryResult writeMemoryResult = 13;
    }
}